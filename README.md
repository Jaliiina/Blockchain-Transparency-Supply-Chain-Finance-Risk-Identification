# Blockchain Transparency · Supply Chain Finance Risk Identification  
区块链驱动的供应链金融风险识别机制研究与最小可行产品（MVP）

---

## 项目概述
本项目结合信息经济学与信号传递理论，研究区块链技术如何通过提升**信息透明度**来改善供应链金融的**风险识别机制**。  
研究从理论、实证与工程实现三个层面展开：

1. **理论层面**  
   构建 “区块链 — 信息透明度 — 风险识别” 分析框架，提出透明度四维度指标体系（T₁–T₄）。  
2. **实证层面**  
   通过回归分析、机器学习模型与可解释性方法（RF、XGBoost、SHAP、Logit、Spearman）验证透明度对风险的影响。  
3. **实现层面（MVP）**  
   基于 Flask + Plotly 构建轻量级可视化原型系统，实现透明度–风险实时展示与区块链哈希验证演示。

系统包含四大核心功能：
- 透明度与风险仪表盘（可视化）
- 高风险交易识别
-区块链哈希与数字签名验证演示
- 智能合约部署与链上交互（区块链应用）

---

## 项目结构
```plaintext
📦 blockchain_mvp/
│── contracts/
│   └── hello_abi.json      # 智能合约基本情况
├── data/
│   └── trust_chain_dataset_2020plus.csv      # 供应链交易数据集
│
├── static/
│   └── style.css                             # 前端样式
│
├── templates/
│   ├── base.html                             # 基础模板
│   └── index.html                            # 仪表盘与交互页面
│
├── app.py                                    # Flask 启动入口
├── blockchain_client.py                      # 区块链配置
├── compute.py                                # 透明度与风险计算逻辑
├── security.py                               # 哈希与签名验证模块
│
├── transparancy/                             # 实验与论文分析结果
│   ├── trust_chain_dataset.csv               # 原始数据结果
│   ├── s3_f.py                               # 风险值与透明度计算函数
│   ├── ml_compare.py                         # 模型性能对比脚本
│   ├── pic_2.py / pic.py                     # 绘图脚本
│   ├── feature_importance_rf.csv             # 随机森林特征重要性
│   ├── feature_importance_xgb.csv            # XGBoost 特征重要性
│   ├── feature_importance_xgb_shap.csv       # SHAP 可解释性结果
│   ├── logit_coefficients.csv                # Logit 回归系数
│   ├── ols_T14_tuned_coefs.csv               # OLS 回归结果
│   ├── ml_cv_results.csv                     # 模型交叉验证结果
│   └── spearman_corr.csv                     # 相关系数矩阵
```
---
## MVP 功能展示

### ①透明度与风险仪表盘

- 实时展示样本量、平均透明度、平均风险及高风险阈值；
- 绘制交互式 “透明度–风险” 散点图；
- 四维透明度均值：

### ②高风险交易识别表

自动筛选风险值 **R** 位于前 25% 的交易记录并展示关键信息。

### ③哈希与签名验证演示

- 计算交易 JSON 的 **SHA-256 哈希**；
- 生成 **ECDSA 数字签名** 并实时验签；
- 当字段被篡改时，系统立即显示 **“哈希不匹配 / 验签失败”**，可视化演示区块链数据不可篡改性。

### ④本地链搭建与智能合约运行

- 本 MVP 通过本地 Geth 私链实现了完整的链上交互流程
   - 启动本地开发链（Chain ID: 1337）
   - 在 Remix 中编写并部署合约
   - 系统后端通过 Web3.py 调用链上合约
   - 前端按钮点击后显示链上返回值
  
## MVP 实现原理

该最小可行产品（MVP）旨在以最简结构验证论文提出的  
“区块链提升信息透明度 → 改善供应链金融风险识别”的核心机制。  
系统以 Flask 为后端框架、Plotly 为可视化前端，实现从数据计算到交互展示的完整闭环。

---

### 1. 架构逻辑

系统整体分为三层：
```
用户前端（浏览器）
        │
        ▼
Flask 后端（API）
        │
        ├── 指标计算模块 compute.py（T1-T4, R）
        ├── 安全模块 security.py（哈希 & 签名）
        ├── 区块链模块 blockchain_client.py（Web3）
        │
        ▼
本地 Geth 区块链节点（智能合约执行）
```

1. **数据层（Data Layer）**  
   存储真实或模拟的供应链交易数据，包括：
   - 交易 ID、供应商、客户、订单金额等基础信息；  
   - 交易哈希、智能合约状态、合规检查结果等链上数据；  
   - 时间、地理坐标、数量偏差、交付周期等动态属性。  

2. **计算层（Compute Layer）**  
   由 `compute.py` 实现，负责信息透明度与风险指标的计算：
   - **T1 可追溯性**：评估交易记录的可验证性与追踪完整度；
   - **T2 完整性**：基于数量一致性、合规性与环境记录的完整性；
   - **T3 披露频率**：评估供应商数据披露的节奏与更新频率；
   - **T4 审计可视度**：衡量交易上链比例与审计可见性；
   - **R 风险值**：综合延迟、欺诈标记、合规失败等六个风险因子，计算综合风险指数；
   - 最终生成综合透明度指标 `T_total = (T1+T2+T3+T4)/4`。

3. **展示层（Presentation Layer）**  
   由 `app.py`（Flask 后端）与 `index.html`（前端模板）构成：
   - Flask 负责 API 路由（如 `/api/scatter`、`/api/highrisk`），动态提供 JSON 数据；
   - Plotly 在前端绘制交互式散点图与仪表卡片；
   - Bootstrap 负责页面布局与响应式样式；
   - 所有计算结果实时渲染到网页仪表盘中，形成动态透明度–风险监控面板。

---

### 2. 哈希与签名验证机制

为了演示“信息可验证性”的技术原理，系统引入 `security.py` 模块：
- 使用 Python **hashlib** 计算交易 JSON 的 **SHA-256 哈希值**；
- 使用 **ECDSA 椭圆曲线签名算法（NIST256p）** 对原始数据签名；
- 用户可在前端修改 JSON 字段，系统实时对比：
  - 若任意字段被篡改 → 哈希立即变化；
  - 原签名验签失败 → 明确展示“数据被修改”；
- 通过此交互式演示，直观体现区块链“不可篡改”“可验证”的底层原理。

---

### 3. 前后端交互流程
```plaintext
用户浏览器 ──→ Flask 后端 ──→ 读取 CSV 数据
←─ JSON 响应 ←─ 指标计算 (T1–T4, R)
↓ ↑
Plotly 绘图 ←── /api/scatter ──→ Compute 模块
高风险表格 ←── /api/highrisk ──→ Risk 函数
哈希验证 ←── /api/hashcheck ──→ Security 模块
```
整个流程模拟了一个最小化的“链上透明度感知系统”：
每次页面刷新都会重新计算指标、生成交互式可视化结果。
---
### 4. 理论映射关系

| 理论概念 | 技术实现 |
|-----------|-----------|
| 信息不对称 | 交易数据中存在缺漏、延迟、错误 |
| 信号传递机制 | 区块链哈希、合规记录、披露频率等透明度信号 |
| 信号可验证性 | ECDSA 数字签名 + 哈希比对 |
| 风险识别机制 | 综合风险值 R 的动态计算与高风险交易识别表 |

---

### 5. 实现意义

该 MVP 以极小系统规模验证了论文提出的关键假设：
> 区块链透明度因子可通过数据可追溯、完整、及时、可验证性，  
> 有效改善供应链金融风险识别与信用传递机制。

系统既可用于研究演示，也可作为后续区块链风控平台原型的基础模块。

## 实验部分

包含论文实验及统计结果文件：

- **OLS / Logit 回归分析**：验证透明度维度对风险的显著性；
- **随机森林 & XGBoost**：量化不同特征的重要性；
- **SHAP 可解释性分析**：识别透明度对模型预测的影响路径；
- **相关性分析（Spearman）**：探索多维透明度指标的内在关系。

---

## 理论与意义

该研究证明：

> 区块链通过提升信息可追溯性、完整性、披露频率与可验证性，显著降低了供应链金融的信用与交易风险。  

MVP 原型展示了“从信号传递理论到工程落地”的完整路径，为后续智能合约自动授信、跨链风控等应用提供技术基础。

## 区块链部分：本地链搭建与智能合约运行

### 1. 本地区块链环境搭建（Geth --dev）

系统采用 Geth 的 `--dev` 模式启动轻量级本地以太坊开发链，用于模拟真实区块链环境下的交易写入与区块生成过程。该模式具有如下特点：

- 无需等待挖矿，交易提交后可即时打包生成新区块；
- 自动创建并加载预置账户，用于合约部署与交易发送；
- Chain ID 固定为 **1337**，适用于本地测试与脚本化部署；
- 支持 Remix IDE 与 Web3.py 等工具实时连接与交互。

示例启动命令如下：

```bash
geth --dev --rpc --rpcaddr 127.0.0.1 --rpcport 8545 \
     --rpcapi "eth,net,web3,personal,txpool"
```

### 2. 智能合约开发与部署流程（AnalysisAnchor）

智能合约基于 Solidity 0.8.21，在 Remix IDE 中完成编写、编译与部署。本项目采用最小化的存证型智能合约 AnalysisAnchor.sol，用于将分析结果摘要以哈希形式写入区块链。

### 3. 区块链客户端集成与链上存证调用（Web3.py）

系统后端通过 Web3.py 建立与本地区块链节点的连接，并加载已部署合约的 ABI 与地址：
```bash
w3 = Web3(Web3.HTTPProvider("http://127.0.0.1:8545"))
contract = w3.eth.contract(
    address=ANCHOR_CONTRACT_ADDRESS,
    abi=ANALYSIS_ANCHOR_ABI
)
```
在应用运行阶段，当前端触发“生成摘要并上链存证”操作时，后端执行以下流程：
完成链下数据分析并生成分析摘要结果；
对数据版本与分析结果分别计算哈希值；
调用合约函数 commitReport(datasetHash, resultHash)；
将摘要哈希以交易形式写入区块链；
返回交易哈希与区块号并反馈至前端界面。
通过该机制，每一次分析结果均对应一条独立、不可篡改的链上记录，实现了“链下计算、链上确权”的区块链应用模式。

### 4. 区块链与供应链风控模型的整合意义
将区块链功能嵌入 MVP 的目的不是“展示技术”，而是验证区块链作为透明度来源的可行性：
| 区块链能力        | 对应透明度维度  | 对风险识别的作用   |
| ------------ | -------- | ---------- |
| 不可篡改性（哈希）    | T1 可追溯性  | 降低数据伪造风险   |
| 上链日志（Tx Log） | T2 完整性   | 提升事件记录全面性  |
| 区块时间戳        | T3 披露频率  | 消除延迟与伪时间戳  |
| 可验证执行        | T4 审计可视度 | 增强被审计机构透明度 |

